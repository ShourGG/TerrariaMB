import{d as J,n as O,p as Q,q as W,s as X,r as b,v as q,o as Y,x as Z,a as V,y as m,w as o,g as f,f as s,j as i,m as _,z as a,t as w,A as F,B as E,C as h,D as ee,E as se,k,G as oe,H as K,I as v,J as re,K as le,u as te,L as ae,i as p,_ as ne}from"./index-_hVn5I9W.js";import{a as ie}from"./authLogin-AlxdDqfg.js";const ue={class:"font-bold text-3xl text-light-50 mb-6px text-center"},de={class:"text-gray-200 text-lg text-center"},me={class:"flex items-center"},pe={class:"ml-6px font-bold text-xl"},ce={class:"flex items-center space-x-3 text-gray-400 mt-16px mb-16px"},fe={class:"text-center"},ge=J({__name:"index",setup(xe){const{isScreen:B}=O(),D=Q(),L=W(),T=X(),A=te(),g=b(!1),M=q("images/logo/logo.webp"),j=q("images/login/bg.png"),C=b(),N=b(),n=b(!1);Y(async()=>{R();const c=await Z();g.value=!c});const r=V({loginName:"",password:"",securityCode:"1234",codeKey:"",captchaPicture:""}),l=V({username:"",password:"",confirmPassword:""}),$=(c,e,d)=>{e===""?d(new Error("请确认密码")):e!==l.password?d(new Error("两次输入的密码不一致")):d()},z=V({loginName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],securityCode:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}),H=V({username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:$,trigger:"blur"}]}),R=async()=>{},I=async()=>{N.value&&N.value.validate(async c=>{if(c){n.value=!0;try{const e={username:l.username,password:l.password};await oe(e)?(r.loginName=l.username,K("注册成功，请登录！"),g.value=!1):v("注册失败，请重试")}catch(e){console.error("注册失败",e),v("注册过程中出现错误，请重试")}finally{n.value=!1}}})},S=()=>{C.value&&C.value.validate(async c=>{if(c){n.value=!0;try{await re(r.loginName,r.password)?(D.setToken(ie.data.tokenValue),await le(),L.setTab([]),T.setKeepAliveName([]),K("登录成功！"),A.push(ae)):v("用户名或密码错误")}catch(e){console.error("登录失败",e),v("登录失败，请重试")}finally{n.value=!1}}else v("表单验证失败，请检查输入")})};return(c,e)=>{const d=f("el-image"),U=f("el-col"),x=f("el-input"),u=f("el-form-item"),y=f("el-button"),P=f("el-form"),G=f("el-row");return p(),m(G,{class:"min-h-screen"},{default:o(()=>[s(U,{lg:16,md:12,sm:0,xs:0,class:"bg-[--el-color-primary] flex items-center justify-center"},{default:o(()=>[i("div",null,[a(B)?_("",!0):(p(),m(d,{key:0,class:"w-400px h-360px mb-50px",src:a(j)},null,8,["src"])),i("div",ue," 欢迎"+w(g.value?"注册":"登录")+" "+w(a(F).loginTitle||"泰拉瑞亚服务器管理系统"),1),i("div",de,w(g.value?"首次使用需要创建账号":"或许我们只是差点运气"),1)])]),_:1}),s(U,{lg:8,md:12,sm:24,xs:24,class:"dark:bg-#121212 bg-gray-100 flex items-center justify-center flex-col"},{default:o(()=>[i("div",me,[s(d,{class:"rounded-full w-36px h-36px",src:a(M)},null,8,["src"]),i("div",pe,w(a(F).loginTitle||"泰拉瑞亚服务器管理系统"),1)]),i("div",ce,[e[6]||(e[6]=i("span",{class:"h-1px w-16 bg-gray-300 inline-block"},null,-1)),i("span",fe,w(g.value?"账号注册":"账号密码登录"),1),e[7]||(e[7]=i("span",{class:"h-1px w-16 bg-gray-300 inline-block"},null,-1))]),g.value?(p(),m(P,{key:1,ref_key:"registerFormRef",ref:N,model:l,rules:H},{default:o(()=>[s(u,{prop:"username"},{default:o(()=>[s(x,{type:"text",placeholder:"请输入用户名","suffix-icon":a(E),modelValue:l.username,"onUpdate:modelValue":e[3]||(e[3]=t=>l.username=t)},null,8,["suffix-icon","modelValue"])]),_:1}),s(u,{prop:"password"},{default:o(()=>[s(x,{type:"password",placeholder:"请输入密码","show-password":"","suffix-icon":a(h),modelValue:l.password,"onUpdate:modelValue":e[4]||(e[4]=t=>l.password=t)},null,8,["suffix-icon","modelValue"])]),_:1}),s(u,{prop:"confirmPassword"},{default:o(()=>[s(x,{type:"password",placeholder:"请确认密码","show-password":"","suffix-icon":a(h),modelValue:l.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=t=>l.confirmPassword=t)},null,8,["suffix-icon","modelValue"])]),_:1}),s(u,null,{default:o(()=>[n.value?_("",!0):(p(),m(y,{key:0,type:"primary",class:"w-245px bg-[--el-color-primary]",round:"",onClick:I},{default:o(()=>e[11]||(e[11]=[k("注册")])),_:1,__:[11]})),n.value?(p(),m(y,{key:1,type:"primary",class:"w-245px bg-[--el-color-primary]",round:"",loading:n.value},{default:o(()=>e[12]||(e[12]=[k("注册中")])),_:1,__:[12]},8,["loading"])):_("",!0)]),_:1})]),_:1},8,["model","rules"])):(p(),m(P,{key:0,ref_key:"loginFormRef",ref:C,model:r,rules:z},{default:o(()=>[s(u,{prop:"userName"},{default:o(()=>[s(x,{type:"text",placeholder:"请输入用户名","suffix-icon":a(E),modelValue:r.loginName,"onUpdate:modelValue":e[0]||(e[0]=t=>r.loginName=t)},null,8,["suffix-icon","modelValue"])]),_:1}),s(u,{prop:"password"},{default:o(()=>[s(x,{type:"password",placeholder:"请输入密码","show-password":"","suffix-icon":a(h),modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=t=>r.password=t)},null,8,["suffix-icon","modelValue"])]),_:1}),s(u,{prop:"securityCode"},{default:o(()=>[s(x,{type:"text",placeholder:"请输入验证码","suffix-icon":a(se),modelValue:r.securityCode,"onUpdate:modelValue":e[2]||(e[2]=t=>r.securityCode=t),onKeydown:ee(S,["enter"])},null,8,["suffix-icon","modelValue"])]),_:1}),s(u,null,{default:o(()=>[s(d,{class:"w-100px h-30px",src:r.captchaPicture,onClick:R},null,8,["src"]),s(y,{text:"",size:"small",class:"ml-6px",onClick:R},{default:o(()=>e[8]||(e[8]=[i("div",{class:"text-gray-400 hover:text-#8B5CF6 select-none"},"看不清，换一张",-1)])),_:1,__:[8]})]),_:1}),s(u,null,{default:o(()=>[n.value?_("",!0):(p(),m(y,{key:0,type:"primary",class:"w-245px bg-[--el-color-primary]",round:"",onClick:S},{default:o(()=>e[9]||(e[9]=[k("登录")])),_:1,__:[9]})),n.value?(p(),m(y,{key:1,type:"primary",class:"w-245px bg-[--el-color-primary]",round:"",loading:n.value},{default:o(()=>e[10]||(e[10]=[k("登录中")])),_:1,__:[10]},8,["loading"])):_("",!0)]),_:1})]),_:1},8,["model","rules"]))]),_:1})]),_:1})}}}),we=ne(ge,[["__scopeId","data-v-5fa12fb9"]]);export{we as default};
