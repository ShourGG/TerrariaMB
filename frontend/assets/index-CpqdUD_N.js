import{d as le,r as u,o as De,a as Ue,g as s,S as P,e as Me,i as g,f as l,w as a,Q as d,j as Q,D as j,y as h,k,R as ee,z as f,t as Re,T as C,I as x,U as N,V as W,W as $,X as ze,ag as Te}from"./index-_hVn5I9W.js";import{u as Be,a as Pe,b as $e,d as Ee,c as Le,l as Oe,g as qe}from"./index-DiRUQRLM.js";import{h as Ae,i as Qe,s as je}from"./index-Ug9vwzts.js";const We={class:"koi-flex"},Xe=le({name:"rolePage"}),Ge=le({...Xe,setup(Ye){const ae=u(!1),E=u(!0),X=u([{roleId:1,roleName:"YU-ADMIN🌻",roleCode:"YU-ADMIN",roleStatus:"0",sorted:1,remark:"超级管理员",createTime:"2023-08-08 23:00:00"},{roleId:2,roleName:"张大仙",roleCode:"ZDX",roleStatus:"0",sorted:2,remark:"虎牙688，每晚七点半，不见不散！",createTime:"2023-08-08 23:00:00"},{roleId:3,roleName:"菜鸡",roleCode:"COMMON",roleStatus:"1",sorted:3,remark:"干饭",createTime:"2023-08-08 23:00:00"}]),p=u({pageNo:1,pageSize:10,roleName:"",roleStatus:"",roleCode:""}),z=u(0),oe=()=>{p.value={pageNo:1,pageSize:10,roleName:"",roleStatus:"",roleCode:""}},te=()=>{console.log("搜索"),p.value.pageNo=1,v()},ne=()=>{console.log("重置搜索"),oe(),v()},v=async()=>{z.value=9},I=async()=>{try{const o=await Oe(p.value);console.log("角色数据表格数据->",o.data),X.value=o.data.records,z.value=o.data.total}catch(o){console.log(o),N("数据查询失败，请刷新重试🌻")}};De(()=>{v()});const V=u([]),L=u(!0),Y=u(!0),re=o=>{console.log(o),V.value=o.map(e=>e.roleId),L.value=o.length!=1,Y.value=!o.length},se=()=>{D(),K.value="角色添加",r.value.roleStatus="0",S.value.koiOpen(),C("添加🌻")},ue=async o=>{if(o==null||o==""){$("请选择需要修改的数据🌻");return}try{const e=await qe(o);console.log(e.data),r.value=e.data}catch(e){console.log(e),N("数据获取失败，请刷新重试🌻")}},F=async o=>{D(),K.value="角色修改";const e=o?o.roleId:V.value[0];(e==null||e=="")&&x("请选择需要修改的数据🌻"),console.log(e),ue(e),S.value.koiOpen(),C("修改🌻")},S=u(),K=u("角色管理"),O=u();let r=u({roleId:null,roleName:null,roleCode:null,roleStatus:null,sorted:1,remark:null});const D=()=>{r.value={roleId:null,roleName:null,roleCode:null,roleStatus:null,sorted:1,remark:null}},de=Ue({roleName:[{required:!0,message:"请输入角色名字",trigger:"null"}],roleCode:[{required:!0,message:"请输入角色编号",trigger:"null"}],roleStatus:[{required:!0,message:"请输入选择角色状态",trigger:"null"}],sorted:[{required:!0,message:"请输入排序号",trigger:"null"}]}),_=u(!1),ie=()=>{O.value&&(_.value=!0,O.value.validate(async o=>{if(o)if(console.log("表单ID",r.value.roleId),r.value.roleId!=null&&r.value.roleId!="")try{await Be(r.value),C("修改成功🌻"),_.value=!1,S.value.koiQuickClose(),D(),v()}catch(e){console.log(e),_.value=!1,N("修改失败，请刷新重试🌻")}else try{await Pe(r.value),C("添加成功🌻"),_.value=!1,S.value.koiQuickClose(),D(),v()}catch(e){console.log(e),_.value=!1,N("添加失败，请刷新重试🌻")}else x("验证失败，请检查填写内容🌻"),_.value=!1}))},pe=()=>{S.value.koiClose()},ce=o=>{let e=o.roleStatus==="0"?"启用":"停用";W("确认要["+e+"]-["+o.roleName+"]角色吗？").then(async()=>{if(D(),!o.roleId||!o.roleStatus){$("请选择需要修改的数据🌻");return}try{await $e(o.roleId,o.roleStatus),C("修改成功🌻")}catch(i){console.log(i),I(),N("修改失败，请刷新重试🌻")}}).catch(()=>{x("已取消🌻")})},me=o=>{const e=o.roleId;if(e==null||e==""){$("请选中需要删除的数据🌻");return}W("您确认需要删除角色名称["+o.roleName+"]么？").then(async()=>{try{await Ee(e),I(),C("删除成功🌻")}catch(i){console.log(i),N("删除失败，请刷新重试🌻"),I()}}).catch(()=>{x("已取消🌻")})},fe=()=>{if(V.value.length==0){ze("请选择需要删除的数据🌻");return}W("您确认需要进行批量删除么？").then(async()=>{try{await Le(V.value),I(),C("批量删除成功🌻")}catch(o){console.log(o),N("批量删除失败，请刷新重试🌻"),I()}}).catch(()=>{x("已取消🌻")})},q=u(),U=u(),H=u([{menuId:1,menuName:"系统管理",children:[{menuId:4,menuName:"日志管理",children:[{menuId:9,menuName:"登录日志"},{menuId:10,menuName:"操作日志"}]}]},{menuId:2,menuName:"监控管理",children:[{menuId:5,menuName:"Redis监控"},{menuId:6,menuName:"服务器监控"}]},{menuId:3,menuName:"资源管理",children:[{menuId:7,menuName:"文件管理"},{menuId:8,menuName:"图片管理"}]}]),ve={id:"menuId",label:"menuName",children:"children"},Z=u(),M=u(),G=async o=>{var e,i;if(K.value="分配菜单🌻",(e=U.value)==null||e.setCheckedKeys([],!1),M.value=(o==null?void 0:o.roleId)||V.value[0],M.value==null||M.value==""){$("请选中需要分配菜单的数据🌻");return}q.value.koiOpen();try{const n=await Ae();H.value=Te(n.data.menuList,"menuId"),Z.value=n.data.spreadList}catch(n){console.log(n),x("菜单资源加载失败🌻")}try{const n=await Qe(M.value);n.data&&((i=U.value)==null||i.setCheckedKeys(n.data,!1))}catch(n){console.log(n),x("角色菜单资源加载失败🌻")}},ge=async()=>{var n,w;_.value=!0;const o=(n=U.value)==null?void 0:n.getCheckedKeys(!1),i=((w=U.value)==null?void 0:w.getHalfCheckedKeys()).concat(o);try{await je(M.value,i),_.value=!1,C("角色菜单保存成功🌻"),window.location.reload}catch(T){console.log(T),x("角色菜单保存失败🌻")}},_e=()=>{q.value.koiClose()};return(o,e)=>{const i=s("el-input"),n=s("el-form-item"),w=s("el-option"),T=s("el-select"),c=s("el-button"),J=s("el-form"),m=s("el-col"),ye=s("KoiToolbar"),B=s("el-row"),b=s("el-table-column"),he=s("el-switch"),A=s("el-tooltip"),ke=s("el-table"),be=s("el-pagination"),Ce=s("el-input-number"),xe=s("KoiDialog"),we=s("el-tree"),Ne=s("KoiDrawer"),Se=s("KoiCard"),Ie=P("throttle"),Ve=P("debounce"),y=P("auth"),Ke=P("loading");return g(),Me("div",We,[l(Se,null,{default:a(()=>[d(l(J,{inline:!0},{default:a(()=>[l(n,{label:"角色名称",prop:"roleName"},{default:a(()=>[l(i,{placeholder:"请输入角色名称",modelValue:p.value.roleName,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value.roleName=t),clearable:"",style:{width:"240px"},onKeyup:j(v,["enter","native"])},null,8,["modelValue"])]),_:1}),l(n,{label:"角色状态",prop:"roleStatus"},{default:a(()=>[l(T,{placeholder:"请选择角色状态",modelValue:p.value.roleStatus,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value.roleStatus=t),clearable:"",style:{width:"240px"},onKeyup:j(v,["enter","native"])},{default:a(()=>[l(w,{label:"启用",value:"0"}),l(w,{label:"停用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"角色编号",prop:"roleCode"},{default:a(()=>[l(i,{placeholder:"请输入角色编号",modelValue:p.value.roleCode,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value.roleCode=t),clearable:"",style:{width:"240px"},onKeyup:j(v,["enter","native"])},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[d((g(),h(c,{type:"primary",icon:"search",plain:""},{default:a(()=>e[15]||(e[15]=[k("搜索")])),_:1,__:[15]})),[[Ie,te]]),d((g(),h(c,{type:"danger",icon:"refresh",plain:""},{default:a(()=>e[16]||(e[16]=[k("重置")])),_:1,__:[16]})),[[Ve,ne]])]),_:1})]),_:1},512),[[ee,E.value]]),l(B,{gutter:10},{default:a(()=>[d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"primary",icon:"plus",plain:"",onClick:e[3]||(e[3]=t=>se())},{default:a(()=>e[17]||(e[17]=[k("新增")])),_:1,__:[17]})]),_:1})),[[y,["system:role:add"]]]),d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"success",icon:"edit",plain:"",onClick:e[4]||(e[4]=t=>F()),disabled:L.value},{default:a(()=>e[18]||(e[18]=[k("修改")])),_:1,__:[18]},8,["disabled"])]),_:1})),[[y,["system:role:update"]]]),d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"danger",icon:"delete",plain:"",onClick:e[5]||(e[5]=t=>fe()),disabled:Y.value},{default:a(()=>e[19]||(e[19]=[k("删除")])),_:1,__:[19]},8,["disabled"])]),_:1})),[[y,["system:role:delete"]]]),d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"warning",icon:"download",plain:""},{default:a(()=>e[20]||(e[20]=[k("导出")])),_:1,__:[20]})]),_:1})),[[y,["system:role:export"]]]),d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"info",icon:"upload",plain:""},{default:a(()=>e[21]||(e[21]=[k("导入")])),_:1,__:[21]})]),_:1})),[[y,["system:role:import"]]]),d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"success",icon:"Postcard",plain:"",disabled:L.value,onClick:e[6]||(e[6]=t=>G())},{default:a(()=>e[22]||(e[22]=[k("分配菜单")])),_:1,__:[22]},8,["disabled"])]),_:1})),[[y,["system:role:import"]]]),d((g(),h(m,{span:1.5},{default:a(()=>[l(c,{type:"info",icon:"upload",plain:""},{default:a(()=>e[23]||(e[23]=[k("测试")])),_:1,__:[23]})]),_:1})),[[y,["system:role:xxx"]]]),l(ye,{showSearch:E.value,"onUpdate:showSearch":e[7]||(e[7]=t=>E.value=t),onRefreshTable:v},null,8,["showSearch"])]),_:1}),e[24]||(e[24]=Q("br",null,null,-1)),d((g(),h(ke,{border:"",data:X.value,"empty-text":"暂时没有数据哟🌻",onSelectionChange:re},{default:a(()=>[l(b,{type:"selection",width:"55",align:"center"}),l(b,{label:"序号",prop:"roleId",width:"120px",align:"center",type:"index"}),l(b,{label:"角色名称",prop:"roleName",width:"120px","show-overflow-tooltip":!0,align:"center"}),l(b,{label:"角色编号",prop:"roleCode",width:"120px",align:"center"}),l(b,{label:"角色状态",prop:"roleStatus",width:"100px",align:"center"},{default:a(t=>[l(he,{modelValue:t.row.roleStatus,"onUpdate:modelValue":R=>t.row.roleStatus=R,"active-text":"启用","inactive-text":"停用","active-value":"0","inactive-value":"1","inline-prompt":!0,onChange:R=>ce(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(b,{label:"角色排序",prop:"sorted",width:"100px",align:"center"}),l(b,{label:"角色备注",prop:"remark",width:"260px","show-overflow-tooltip":!0,align:"center"}),l(b,{label:"创建时间",prop:"createTime",width:"180px",align:"center"}),l(b,{label:"操作",align:"center",width:"150",fixed:"right"},{default:a(({row:t})=>[l(A,{content:"修改🌻",placement:"top"},{default:a(()=>[d(l(c,{type:"primary",icon:"Edit",circle:"",plain:"",onClick:R=>F(t)},null,8,["onClick"]),[[y,["system:role:update"]]])]),_:2},1024),l(A,{content:"删除🌻",placement:"top"},{default:a(()=>[d(l(c,{type:"danger",icon:"Delete",circle:"",plain:"",onClick:R=>me(t)},null,8,["onClick"]),[[y,["system:role:delete"]]])]),_:2},1024),l(A,{content:"分配菜单🌻",placement:"top"},{default:a(()=>[d(l(c,{type:"info",icon:"Postcard",circle:"",plain:"",onClick:R=>G(t)},null,8,["onClick"]),[[y,["system:role:delete"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ke,ae.value]]),e[25]||(e[25]=Q("br",null,null,-1)),d(l(be,{background:"","current-page":p.value.pageNo,"onUpdate:currentPage":e[8]||(e[8]=t=>p.value.pageNo=t),"page-size":p.value.pageSize,"onUpdate:pageSize":e[9]||(e[9]=t=>p.value.pageSize=t),"page-sizes":[10,20,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"]),[[ee,z.value>0]]),l(xe,{ref_key:"koiDialogRef",ref:S,title:K.value,onKoiConfirm:ie,onKoiCancel:pe,loading:_.value},{content:a(()=>[l(J,{ref_key:"formRef",ref:O,rules:de,model:f(r),"label-width":"80px","status-icon":""},{default:a(()=>[l(B,null,{default:a(()=>[l(m,{xs:{span:24},sm:{span:12}},{default:a(()=>[l(n,{label:"角色名称",prop:"roleName"},{default:a(()=>[l(i,{modelValue:f(r).roleName,"onUpdate:modelValue":e[10]||(e[10]=t=>f(r).roleName=t),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{xs:{span:24},sm:{span:12},class:"p-l-10px"},{default:a(()=>[l(n,{label:"角色编号",prop:"roleCode"},{default:a(()=>[l(i,{modelValue:f(r).roleCode,"onUpdate:modelValue":e[11]||(e[11]=t=>f(r).roleCode=t),placeholder:"请输入角色编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(B,null,{default:a(()=>[l(m,{xs:{span:24},sm:{span:12}},{default:a(()=>[l(n,{label:"角色状态",prop:"roleStatus"},{default:a(()=>[l(T,{modelValue:f(r).roleStatus,"onUpdate:modelValue":e[12]||(e[12]=t=>f(r).roleStatus=t),placeholder:"请选择角色状态",style:{width:"260px"},clearable:""},{default:a(()=>[l(w,{label:"启用",value:"0"}),l(w,{label:"停用",value:"1"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{xs:{span:24},sm:{span:12},class:"p-l-10px"},{default:a(()=>[l(n,{label:"角色排序",prop:"sorted"},{default:a(()=>[l(Ce,{modelValue:f(r).sorted,"onUpdate:modelValue":e[13]||(e[13]=t=>f(r).sorted=t),style:{width:"260px"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(B,null,{default:a(()=>[l(m,{xs:{span:24},sm:{span:24}},{default:a(()=>[l(n,{label:"角色备注",prop:"remark"},{default:a(()=>[l(i,{modelValue:f(r).remark,"onUpdate:modelValue":e[14]||(e[14]=t=>f(r).remark=t),rows:5,type:"textarea",placeholder:"请输入角色备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"]),k(" "+Re(f(r)),1)]),_:1},8,["title","loading"]),l(Ne,{ref_key:"koiDrawerRef",ref:q,title:K.value,size:"360",onKoiConfirm:ge,onKoiCancel:_e,loading:_.value,cancelText:"关闭"},{content:a(()=>[Q("div",null,[l(we,{ref_key:"treeRef",ref:U,data:H.value,"show-checkbox":"","default-expand-all":!1,"default-expanded-keys":Z.value,"node-key":"menuId","highlight-current":"",props:ve},null,8,["data","default-expanded-keys"])])]),_:1},8,["title","loading"])]),_:1,__:[24,25]})])}}});export{Ge as default};
